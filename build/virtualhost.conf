<VirtualHost *:80>
	Define root /var/www

	DocumentRoot ${root}/public

	<Directory ${root}/public>
		Options +FollowSymLinks -MultiViews
		AllowOverride None
		Allow from All

		# send all requests to the router
		<IfModule mod_rewrite.c>
			RewriteEngine On
			RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::\2$
			RewriteRule ^(.*) - [E=BASE:%1]
			RewriteCond %{HTTP:Authorization} .
			RewriteRule ^ - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
			RewriteCond %{ENV:REDIRECT_STATUS} ^$
			RewriteRule ^index\.php(?:/(.*)|$) %{ENV:BASE}/$1 [R=301,L]
			RewriteCond %{REQUEST_FILENAME} -f
			RewriteRule ^ - [L]
			RewriteRule ^ %{ENV:BASE}/index.php [L]
		</IfModule>

		# if rewrite disabled, simple redirection to the index file
		<IfModule !mod_rewrite.c>
			<IfModule mod_alias.c>
				RedirectMatch 302 ^/$ /index.php/
			</IfModule>
		</IfModule>
	</Directory>

	# don't send requests to static assets to the router
	<Directory ${root}/public/assets>
		<IfModule mod_rewrite.c>
			RewriteEngine Off
		</IfModule>
	</Directory>

	ErrorLog ${root}/var/log/error.log
	CustomLog ${root}/var/log/access.log combined
</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
